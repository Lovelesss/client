<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>leaflet克里金空间插值</title>
  <style>
    html, body {
      font-size: 14px;
      width: 100%;
      height: 100%;
      margin: 0;
      padding: 0;
      overflow: hidden;
      cursor: default;
      color: #606266
    }

    li {
      list-style: none;
    }

    #map {
      position: absolute;
      width: 100%;
      height: 100%;
      top: 35px
    }

    .icon {
      /*width: 3px;*/
      /*height: 3px;*/
      border: 1px solid #606266;
      border-radius: 50%;
    }

    .icon-red {
      width: 5px;
      height: 5px;
      background: rgba(255, 0, 0, 0.7);
      border-radius: 50%;
    }

    body > #sidebar {
      display: none;
    }

    /* 侧边栏表格样式 */
    .station-info {
      width: 98%;
      border-collapse: collapse;
    }

    .station-info td {
      box-sizing: border-box;
      width: 50%;
      height: 48px;
      padding: 5px;
      border: 1px solid #555555;
      text-align: center;
    }

    /* 隐藏marker x号 */
    .leaflet-popup-close-button {
      display: none;
    }

    /* 图例 */
    .legend {
      text-align: left;
      line-height: 18px;
      color: #555;
    }

    .legend i {
      width: 18px;
      height: 18px;
      float: left;
      margin-right: 8px;
      opacity: 0.7;
    }

    /* 侧边栏按钮组 */
    .button-group {
      margin-top: 10px;
    }

    .btn {
      display: inline-block;
      margin-top: 20px;
      width: 48%;
      height: 40px;
      line-height: 40px;
      cursor: pointer;
      border: 1px solid #dcdfe6;
      border-radius: 4px;
      font-size: 12px;
    }

    .btn:hover {
      border-color: #409eff;
      color: #409eff;
    }

    .forecast {
      display: inline-block;
      margin-top: 20px;
      width: 48%;
      height: 40px;
      line-height: 40px;
      cursor: pointer;
      border: 1px solid #dcdfe6;
      border-radius: 4px;
      background: #67c23a;
      color: #fff;
      font-size: 14px;
    }

    .forecast:hover {
      background: rgba(103, 194, 58, 0.8);
    }

    /* 固定导航 */
    .header {
      box-sizing: border-box;
      position: fixed;
      height: 35px;
      /*line-height: 35px;*/
      width: 100%;
      z-index: 999;
      background: #09c;
      font-size: 12px;
    }

    .element-wrap {
      display: flex;
      float: right;
      margin: 0;
      cursor: pointer;
      height: 35px;
      margin-right: 20px;
    }

    .element-title {
      position: relative;
      height: 35px;
      line-height: 35px;
      width: 100px;
      text-align: center;
      color: #fff;
    }

    .element {
      display: none;
      padding: 0;
      position: absolute;
      left: 0;
      width: 100px;
      top: 35px;
    }

    .element li {
      width: 100px;
      height: 35px;
      background: #09c;
      margin-top: 2px;
      border-radius: 4px;
    }

    .element-title:hover {
      background: #0078A8;
    }

    .element-title:hover .element {
      display: block;
    }

    /*.banner {*/
    /*  height: 20px;*/
    /*  width: 100%;*/
    /*  text-align: center;*/
    /*}*/
    /* 日期选择 */
    .date-picker {
      position: absolute;
      left: 300px;
      top: 70px;
      z-index: 9999;
    }

  </style>
  <style>
    .item-control {
      width: 360px;
      cursor: default;
      position: absolute;
      left: 300px;
      z-index: 9999;
      /*transform: translate(-50%, -50%);*/
    }

    .item-control .select-wrap {
      width: 75%;
    }

    .item-control .select-wrap .title {
      height: 35px;
      /*border: 1px solid rgba(0, 0, 0, 0.14);*/
      border-radius: 4px;
      box-sizing: border-box;
      padding: 0 10px;
      line-height: 35px;
      font-size: 14px;
      color: rgba(0, 0, 0, 0.36);
      background: #fff;
    }

    .item-control .select-wrap .title .text.completed {
      color: rgba(0, 0, 0, 0.8);
    }

    .item-control .select-wrap .option {
      position: absolute;
      left: 0;
      top: 36px;
      width: 75%;
      background: white;
      border: 1px solid rgba(0, 0, 0, 0.14);
      box-sizing: border-box;
      z-index: 10;
      display: none;
    }

    .item-control .select-wrap.folder .option {
      display: none;
    }

    .item-control .select-wrap.spread .option {
      display: block;
    }

    /* 实时坐标 */
    .lonlat {
      width: 420px;
      /*padding: 0 5px;*/
      background: #fff;
      position: absolute;
      right: 10px;
      bottom: 10px;
      z-index: 9999;
      text-align: center;
    }

    /* 图例 */
    .legend {
      background: rgba(255, 255, 255, 1);
      bottom: 50px;
    }
  </style>
  <script src="https://cdn.bootcss.com/echarts/4.2.1/echarts.min.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.5.1/dist/leaflet.css"/>
  <script src="https://cdn.bootcss.com/jquery/3.0.0/jquery.min.js"></script>
  <script src="https://unpkg.com/leaflet@1.5.1/dist/leaflet.js"></script>
  <script src="https://unpkg.com/esri-leaflet@2.2.4/dist/esri-leaflet.js"></script>
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
  <script src="js/kriging.js"></script>
  <script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"></script>
  <script src="js/world.js"></script>
  <link rel="stylesheet" href="style/iconfont.css">
  <!--    侧边栏-->
  <link rel="stylesheet" href="style/L.Control.Sidebar.css"/>
  <script src="js/L.Control.Sidebar.js"></script>
  <!--    marker高亮-->
  <link rel="stylesheet" href="style/highlight.css">
  <script src="js/highlight.js"></script>
  <!--  日期选择-->
  <link rel="stylesheet" href="style/calendar.css">
  <script src="js/calendar.js"></script>
</head>
<body>
<div id="sidebar">
  <h2>站点名称:<span class="station-name"></span></h2>
  <table class="station-info">
    <tr>
      <td colspan="2" class="station-date"></td>
    </tr>
    <tr>
      <td>站点号</td>
      <td class="station-id"></td>
    </tr>
    <tr>
      <td>经度(lng)</td>
      <td class="station-lon"></td>
    </tr>
    <tr>
      <td>纬度(lat)</td>
      <td class="station-lat"></td>
    </tr>
    <tr>
      <td>观测场海拔(m)</td>
      <td class="observe-alt"></td>
    </tr>
    <tr>
      <td>实时气温(&#8451;)</td>
      <td class="temp"></td>
    </tr>
    <tr>
      <td>本小时降雨量(mm)</td>
      <td class="rain"></td>
    </tr>
    <tr>
      <td>相对湿度(%)</td>
      <td class="rhu"></td>
    </tr>
    <tr>
      <td>气压(hpa)</td>
      <td class="prs"></td>
    </tr>
  </table>
  <div class="button-group">
    <button class="btn hour-temp">小时气温序列</button>
    <button class="btn hour-rain">小时降雨量序列</button>
    <button class="btn day-temp">日平均气温序列</button>
    <button class="btn day-rain">日总降雨量序列</button>
    <button class="forecast">农业特色预报</button>
  </div>
</div>
<div class="header">
  <section class="item-control">
    <div class="select-wrap folder">
      <div class="title js-select-calendar">
        <span class="text">请选择时间</span>
      </div>
      <div class="option calendar js-option-calendar"></div>
    </div>
  </section>
  <ul class="element-wrap">
    <!--    <li class="element-title">-->
    <!--      <i class="iconfont icon-tianqi-copy"></i>-->
    <!--      预警-->
    <!--      <ul class="element">-->
    <!--        <li class="element-btn 24-hour">24小时</li>-->
    <!--        <li class="element-btn 48-hour">48小时</li>-->
    <!--      </ul>-->
    <!--    </li>-->

    <li class="element-title">
      <i class="iconfont icon-tianqi-copy"></i>
      气象要素
      <ul class="element">
        <li class="element-btn temp-btn">气温</li>
        <li class="element-btn rain-btn">降水</li>
        <li class="element-btn humidity-btn">相对湿度</li>
      </ul>
    </li>

  </ul>
</div>
<!--<div class="banner">2019-11-11</div>-->
<div class="lonlat">
  <span class="zoom"></span>
  <span class="lon"></span>
  <span class="lat"></span>
</div>
<canvas id="canvasMap" style="display:none;"></canvas>

<div id="map">

</div>
<script>

</script>
<script type="module">
  import { formatPoint } from './util/format.js'

  const map = L.map('map', {
    center: [29.65953686, 102.8696333],
    zoom: 7,
    minZoom: 6,
    maxZoom: 15
  })
  const url = 'http://webrd0{s}.is.autonavi.com/appmaptile?x={x}&y={y}&z={z}&lang=zh_cn&size=1&scale=1&style=8'
  new L.TileLayer(url, {
    subdomains: '1234'
  }).addTo(map)

  // 侧边栏
  const sidebar = L.control.sidebar('sidebar', {
    closeButton: true,
    position: 'left'
  })
  map.addControl(sidebar)
  // setTimeout(function () {
  //     sidebar.show();
  // }, 500);
  map.on('click', function() {
    sidebar.hide()
  })

  let positions = []
  world[0].forEach(function(point) {
    positions.push([point[1], point[0]])
  })

  const xlim = [97.3481, 108.5467]
  const ylim = [26.0459, 34.3129]

  let points = []

  function loadTemp(month, day) {
    const param = {
      month: 6,
      day: 27,
      hour: 22
    }
    map.eachLayer(function(layer) {
      if (!layer._container || ('' + $(layer._container).attr('class')).replace(/\s/g, '') !== 'leaflet-layer') {
        layer.remove()
      }
    })
    for (var key in map.boxZoom._map._layers) {
      delete map.boxZoom._map._layers[key]
    }
    axios.get('http://localhost:3000/weathers/kri-hour', { params: param }).then(res => {
      points = res.data.result
      console.log(points)
      document.querySelector('.station-date').innerText = `2019年${param.month}月${param.day}日${param.hour}时`

      function loadkriging() {
        const canvas = document.getElementById('canvasMap')
        canvas.width = 1000
        canvas.height = 1000
        const n = points.length
        let t = [] // 温度
        let x = [] // 经度
        let y = [] // 纬度
        let r = [] // 降雨
        let prs = [] //气压  pressure
        let rhu = [] //相对湿度  relative humidity
        let stationId = []  // 站点号
        let stationName = [] // 站点名
        let observe_alt = [] // 观测场海拔
        const myIcon = L.divIcon({
          className: 'icon'
        })
        const redIcon = L.divIcon({
          className: 'icon-red'
        })
        for (let i = 0; i < n; i++) {
          console.log(typeof points[i].docs[0].lat)
          t.push(parseFloat(points[i].TEM))
          r.push(parseFloat(points[i].PRE_1h))
          prs.push(parseFloat(points[i].PRS))
          rhu.push(parseFloat(points[i].RHU))
          x.push(parseFloat(points[i].docs[0].lon))  // lon
          y.push(parseFloat(points[i].docs[0].lat))  // lat
          stationName.push(points[i].docs[0].Station_name)
          stationId.push(points[i].docs[0].Station_Id_C)
          observe_alt.push(points[i].docs[0].Observe_alt)
          // L.circle([y[i], x[i]], {radius: 1}).addTo(map);
          if (i > 4) {
            L.marker([y[i], x[i]], { icon: myIcon }).addTo(map).on('click', function(e) {
              let point = formatPoint(y[i], x[i])
              console.log(point)
              document.querySelector('.station-name').innerHTML = stationName[i]
              document.querySelector('.station-id').innerHTML = stationId[i]
              document.querySelector('.station-lon').innerHTML = point[1]
              document.querySelector('.station-lat').innerHTML = point[0]
              document.querySelector('.observe-alt').innerHTML = `${observe_alt[i]}m`
              document.querySelector('.temp').innerHTML = t[i] + '&#8451'
              document.querySelector('.rain').innerHTML = r[i] + 'mm'
              document.querySelector('.rhu').innerHTML = rhu[i] + '%'
              document.querySelector('.prs').innerHTML = prs[i] + 'hpa'
              sidebar.show()
              // 侧边栏跳转
              const hourTemp = document.querySelector('.hour-temp')
              const hourRain = document.querySelector('.hour-rain')
              const dayTemp = document.querySelector('.day-temp')
              const dayRain = document.querySelector('.day-rain')
              const forecast = document.querySelector('.forecast')

              function toHourTemp() {
                window.location.href = `http://localhost:9528/#/station/hourtemp?stationName=${stationName[i]}`
              }

              function toHourRain() {
                window.location.href = `http://localhost:9528/#/station/hourrain?stationName=${stationName[i]}`
              }

              function toDayTemp() {
                window.location.href = `http://localhost:9528/#/station/daytemp?stationName=${stationName[i]}`
              }

              function toDayRain() {
                window.location.href = `http://localhost:9528/#/station/dayrain?stationName=${stationName[i]}`
              }

              function toForecast() {
                window.location.href = `http://localhost:9528/#/forecast/index?stationName=${stationName[i]}&lon=${x[i]}&lat=${y[i]}`
              }

              hourTemp.addEventListener('click', toHourTemp)
              hourRain.addEventListener('click', toHourRain)
              dayTemp.addEventListener('click', toDayTemp)
              dayRain.addEventListener('click', toDayRain)
              forecast.addEventListener('click', toForecast)

            }).on('mouseover', function(e) {
              e.target.options.className = 'icon-hover'
              this.bindPopup(`${stationName[i]}:${t[i]}&#8451`).openPopup()
            }).on('mouseout', function() {
              this.closePopup()
            })
          } else {
            L.marker([y[i], x[i]], { icon: redIcon, highlight: 'permanent' }).addTo(map).on('click', function(e) {
              let point = formatPoint(y[i], x[i])
              document.querySelector('.station-name').innerHTML = `气象站名：${stationName[i]}`
              document.querySelector('.station-id').innerHTML = stationId[i]
              document.querySelector('.lon').innerHTML = point[1]
              document.querySelector('.lat').innerHTML = point[0]
              document.querySelector('.observe-alt').innerHTML = `${observe_alt[i]}m`
              document.querySelector('.temp').innerHTML = t[i] + '&#8451'
              sidebar.show()
            }).on('mouseover', function(e) {
              e.target.options.className = 'icon-hover'
              this.bindPopup(`${stationName[i]}:${t[i]}&#8451`).openPopup()
            }).on('mouseout', function() {
              this.closePopup()
            })
          }
          console.log(prs)
          console.log(rhu)

        }

        // 根据属性范围设置渲染颜色
        function getColor(d) {
          return d > 45 ? '#44000b' :
            d > 40 ? '#650015' :
              d > 35 ? '#ab0110' :
                d > 30 ? '#eb481f' :
                  d > 25 ? '#f07609' :
                    d > 20 ? '#f19906' :
                      d > 15 ? '#ffcc4f' :
                        d > 10 ? '#ffe479' :
                          d > 5 ? '#f8f1a1' :
                            d > 0 ? '#fefec6' :
                              d > -5 ? '#c1e6f9' :
                                d > -10 ? '#96cef4' :
                                  d > -15 ? '#67b7f7' :
                                    d > -20 ? '#3492f4' :
                                      d > -25 ? '#1a6bd7' :
                                        d > -30 ? '#0c43c4' :
                                          d > -35 ? '#0c2695' :
                                            d > -40 ? '#0d0b66' :
                                              d > -45 ? '#4a008b' :
                                                '#2e0057'
        }

        // 清除图例
        if (document.querySelector('.legend') !== null) {
          document.querySelector('.legend').parentNode.removeChild(document.querySelector('.legend').parentNode.firstChild)
        }
        //图例

        var legend = L.control({ position: 'bottomright' })

        legend.onAdd = function(map) {
          var div = L.DomUtil.create('div', 'info legend'),
            grades = [],
            labels = []
          for(let i = -50; i < 50; i = i + 5) {
            grades.push(i)
          }
          console.log(grades)
          for (var i = 0; i < grades.length; i++) {
            div.innerHTML +=
              '<i style="background:' + getColor(grades[i] + 1) + '"></i>' +
              grades[i] + (grades[i + 1] ? '&ndash;' + grades[i + 1] + '<br>' : '+')
          }
          return div
        }
        legend.addTo(map)

        let variogram = kriging.train(t, x, y, 'exponential', 0, 100)
        const width = 0.05
        let grid = kriging.grid(world, variogram, width)
        //const colors = ['#00A600', '#01A600', '#03A700', '#04A700', '#05A800', '#07A800', '#08A900', '#09A900', '#0BAA00', '#0CAA00', '#0DAB00', '#0FAB00', '#10AC00', '#12AC00', '#13AD00', '#14AD00', '#16AE00', '#17AE00', '#19AF00', '#1AAF00', '#1CB000', '#1DB000', '#1FB100', '#20B100', '#22B200', '#23B200', '#25B300', '#26B300', '#28B400', '#29B400', '#2BB500', '#2CB500', '#2EB600', '#2FB600', '#31B700', '#33B700', '#34B800', '#36B800', '#37B900', '#39B900', '#3BBA00', '#3CBA00', '#3EBB00', '#3FBB00', '#41BC00', '#43BC00', '#44BD00', '#46BD00', '#48BE00', '#49BE00', '#4BBF00', '#4DBF00', '#4FC000', '#50C000', '#52C100', '#54C100', '#55C200', '#57C200', '#59C300', '#5BC300', '#5DC400', '#5EC400', '#60C500', '#62C500', '#64C600', '#66C600', '#67C700', '#69C700', '#6BC800', '#6DC800', '#6FC900', '#71C900', '#72CA00', '#74CA00', '#76CB00', '#78CB00', '#7ACC00', '#7CCC00', '#7ECD00', '#80CD00', '#82CE00', '#84CE00', '#86CF00', '#88CF00', '#8AD000', '#8BD000', '#8DD100', '#8FD100', '#91D200', '#93D200', '#95D300', '#97D300', '#9AD400', '#9CD400', '#9ED500', '#A0D500', '#A2D600', '#A4D600', '#A6D700', '#A8D700', '#AAD800', '#ACD800', '#AED900', '#B0D900', '#B2DA00', '#B5DA00', '#B7DB00', '#B9DB00', '#BBDC00', '#BDDC00', '#BFDD00', '#C2DD00', '#C4DE00', '#C6DE00', '#C8DF00', '#CADF00', '#CDE000', '#CFE000', '#D1E100', '#D3E100', '#D6E200', '#D8E200', '#DAE300', '#DCE300', '#DFE400', '#E1E400', '#E3E500', '#E6E600', '#E6E402', '#E6E204', '#E6E105', '#E6DF07', '#E6DD09', '#E6DC0B', '#E6DA0D', '#E6D90E', '#E6D710', '#E6D612', '#E7D414', '#E7D316', '#E7D217', '#E7D019', '#E7CF1B', '#E7CE1D', '#E7CD1F', '#E7CB21', '#E7CA22', '#E7C924', '#E8C826', '#E8C728', '#E8C62A', '#E8C52B', '#E8C42D', '#E8C32F', '#E8C231', '#E8C133', '#E8C035', '#E8BF36', '#E9BE38', '#E9BD3A', '#E9BC3C', '#E9BB3E', '#E9BB40', '#E9BA42', '#E9B943', '#E9B945', '#E9B847', '#E9B749', '#EAB74B', '#EAB64D', '#EAB64F', '#EAB550', '#EAB552', '#EAB454', '#EAB456', '#EAB358', '#EAB35A', '#EAB35C', '#EBB25D', '#EBB25F', '#EBB261', '#EBB263', '#EBB165', '#EBB167', '#EBB169', '#EBB16B', '#EBB16C', '#EBB16E', '#ECB170', '#ECB172', '#ECB174', '#ECB176', '#ECB178', '#ECB17A', '#ECB17C', '#ECB17E', '#ECB27F', '#ECB281', '#EDB283', '#EDB285', '#EDB387', '#EDB389', '#EDB38B', '#EDB48D', '#EDB48F', '#EDB591', '#EDB593', '#EDB694', '#EEB696', '#EEB798', '#EEB89A', '#EEB89C', '#EEB99E', '#EEBAA0', '#EEBAA2', '#EEBBA4', '#EEBCA6', '#EEBDA8', '#EFBEAA', '#EFBEAC', '#EFBFAD', '#EFC0AF', '#EFC1B1', '#EFC2B3', '#EFC3B5', '#EFC4B7', '#EFC5B9', '#EFC7BB', '#F0C8BD', '#F0C9BF', '#F0CAC1', '#F0CBC3', '#F0CDC5', '#F0CEC7', '#F0CFC9', '#F0D1CB', '#F0D2CD', '#F0D3CF', '#F1D5D1', '#F1D6D3', '#F1D8D5', '#F1D9D7', '#F1DBD8', '#F1DDDA', '#F1DEDC', '#F1E0DE', '#F1E2E0', '#F1E3E2', '#F2E5E4', '#F2E7E6', '#F2E9E8', '#F2EBEA', '#F2ECEC', '#F2EEEE', '#F2F0F0', '#F2F2F2']
        const colors = [
          { min: -50, max: -45, color: '#2e0057' },
          { min: -45, max: -40, color: '#4a008b' },
          { min: -40, max: -35, color: '#0d0b66' },
          { min: -35, max: -30, color: '#0c2695' },
          { min: -30, max: -25, color: '#0c43c4' },
          { min: -25, max: -20, color: '#1a6bd7' },
          { min: -20, max: -15, color: '#3492f4' },
          { min: -15, max: -10, color: '#67b7f7' },
          { min: -10, max: -5, color: '#96cef4' },
          { min: -5, max: -0, color: '#c1e6f9' },
          { min: 0, max: 5, color: '#fefec6' },
          { min: 5, max: 10, color: '#f8f1a1' },
          { min: 10, max: 15, color: '#ffe479' },
          { min: 15, max: 20, color: '#ffcc4f' },
          { min: 20, max: 25, color: '#f19906' },
          { min: 25, max: 30, color: '#f07609' },
          { min: 30, max: 35, color: '#eb481f' },
          { min: 35, max: 40, color: '#ab0110' },
          { min: 40, max: 45, color: '#650015' },
          { min: 45, max: 50, color: '#44000b' }
        ]
        kriging.plot(canvas, grid, [97.3481, 108.5467], [26.0459, 34.3129], colors)
      }

      function returnImgae() {
        const mycanvas = document.getElementById('canvasMap')
        return mycanvas.toDataURL('image/png')
      }

      loadkriging()

      const imageBounds = [[26.0459, 97.3481], [34.3129, 108.5467]]
      L.imageOverlay(returnImgae(), imageBounds, { opacity: 0.8 }).addTo(map)
    })
  }

  // 相对湿度
  function loadHumidity() {
    const param = {
      month: 7,
      day: 1,
      hour: 1
    }
    //移除除底图外的所有图层
    map.eachLayer(function(layer) {
      if (!layer._container || ('' + $(layer._container).attr('class')).replace(/\s/g, '') !== 'leaflet-layer') {
        layer.remove()
      }
    })
    for (var key in map.boxZoom._map._layers) {
      delete map.boxZoom._map._layers[key]
    }
    axios.get('http://localhost:3000/weathers/kri-hour', { params: param }).then(res => {
      points = res.data.result
      console.log(points)

      function loadkriging() {
        const canvas = document.getElementById('canvasMap')
        canvas.width = 1000
        canvas.height = 1000
        const n = points.length
        let t = [] // 温度
        let x = [] // 经度
        let y = [] // 纬度
        let r = [] // 降雨
        let prs = [] //气压  pressure
        let rhu = [] //相对湿度  relative humidity
        let stationId = []  // 站点号
        let stationName = [] // 站点名
        let observe_alt = [] // 观测场海拔
        const myIcon = L.divIcon({
          className: 'icon'
        })
        const redIcon = L.divIcon({
          className: 'icon-red'
        })
        for (let i = 0; i < n; i++) {
          t.push(parseFloat(points[i].TEM))
          r.push(parseFloat(points[i].PRE_1h))
          prs.push(parseFloat(points[i].PRS))
          rhu.push(parseFloat(points[i].RHU))
          x.push(parseFloat(points[i].docs[0].lon))  // lon
          y.push(parseFloat(points[i].docs[0].lat))  // lat
          stationName.push(points[i].docs[0].Station_name)
          stationId.push(points[i].docs[0].Station_Id_C)
          observe_alt.push(points[i].docs[0].Observe_alt)
          // L.circle([y[i], x[i]], {radius: 1}).addTo(map);
          L.marker([y[i], x[i]], { icon: myIcon }).addTo(map).on('click', function(e) {
            let point = formatPoint(y[i], x[i])
            document.querySelector('.station-name').innerHTML = stationName[i]
            document.querySelector('.station-id').innerHTML = stationId[i]
            document.querySelector('.station-lon').innerHTML = point[1]
            document.querySelector('.station-lat').innerHTML = point[0]
            document.querySelector('.observe-alt').innerHTML = `${observe_alt[i]}m`
            document.querySelector('.temp').innerHTML = t[i] + '&#8451'
            document.querySelector('.rain').innerHTML = r[i] + 'mm'
            sidebar.show()
            // 侧边栏跳转
            const hourTemp = document.querySelector('.hour-temp')
            const hourRain = document.querySelector('.hour-rain')
            const dayTemp = document.querySelector('.day-temp')
            const dayRain = document.querySelector('.day-rain')

            function toHourTemp() {
              window.location.href = `http://localhost:9528/#/station/hourtemp?stationName=${stationName[i]}`
            }

            function toHourRain() {
              window.location.href = `http://localhost:9528/#/station/hourrain?stationName=${stationName[i]}`
            }

            function toDayTemp() {
              window.location.href = `http://localhost:9528/#/station/daytemp?stationName=${stationName[i]}`
            }

            function toDayRain() {
              window.location.href = `http://localhost:9528/#/station/dayrain?stationName=${stationName[i]}`
            }

            hourTemp.addEventListener('click', toHourTemp)
            hourRain.addEventListener('click', toHourRain)
            dayTemp.addEventListener('click', toDayTemp)
            dayRain.addEventListener('click', toDayRain)
          }).on('mouseover', function(e) {
            e.target.options.className = 'icon-hover'
            this.bindPopup(`${stationName[i]}:${rhu[i]}%`).openPopup()
          }).on('mouseout', function() {
            this.closePopup()
          })
        }

        let variogram = kriging.train(rhu, x, y, 'exponential', 0, 100)
        const width = 0.05
        let grid = kriging.grid(world, variogram, width)
        // const colors = ['#00A600', '#01A600', '#03A700', '#04A700', '#05A800', '#07A800', '#08A900', '#09A900', '#0BAA00', '#0CAA00', '#0DAB00', '#0FAB00', '#10AC00', '#12AC00', '#13AD00', '#14AD00', '#16AE00', '#17AE00', '#19AF00', '#1AAF00', '#1CB000', '#1DB000', '#1FB100', '#20B100', '#22B200', '#23B200', '#25B300', '#26B300', '#28B400', '#29B400', '#2BB500', '#2CB500', '#2EB600', '#2FB600', '#31B700', '#33B700', '#34B800', '#36B800', '#37B900', '#39B900', '#3BBA00', '#3CBA00', '#3EBB00', '#3FBB00', '#41BC00', '#43BC00', '#44BD00', '#46BD00', '#48BE00', '#49BE00', '#4BBF00', '#4DBF00', '#4FC000', '#50C000', '#52C100', '#54C100', '#55C200', '#57C200', '#59C300', '#5BC300', '#5DC400', '#5EC400', '#60C500', '#62C500', '#64C600', '#66C600', '#67C700', '#69C700', '#6BC800', '#6DC800', '#6FC900', '#71C900', '#72CA00', '#74CA00', '#76CB00', '#78CB00', '#7ACC00', '#7CCC00', '#7ECD00', '#80CD00', '#82CE00', '#84CE00', '#86CF00', '#88CF00', '#8AD000', '#8BD000', '#8DD100', '#8FD100', '#91D200', '#93D200', '#95D300', '#97D300', '#9AD400', '#9CD400', '#9ED500', '#A0D500', '#A2D600', '#A4D600', '#A6D700', '#A8D700', '#AAD800', '#ACD800', '#AED900', '#B0D900', '#B2DA00', '#B5DA00', '#B7DB00', '#B9DB00', '#BBDC00', '#BDDC00', '#BFDD00', '#C2DD00', '#C4DE00', '#C6DE00', '#C8DF00', '#CADF00', '#CDE000', '#CFE000', '#D1E100', '#D3E100', '#D6E200', '#D8E200', '#DAE300', '#DCE300', '#DFE400', '#E1E400', '#E3E500', '#E6E600', '#E6E402', '#E6E204', '#E6E105', '#E6DF07', '#E6DD09', '#E6DC0B', '#E6DA0D', '#E6D90E', '#E6D710', '#E6D612', '#E7D414', '#E7D316', '#E7D217', '#E7D019', '#E7CF1B', '#E7CE1D', '#E7CD1F', '#E7CB21', '#E7CA22', '#E7C924', '#E8C826', '#E8C728', '#E8C62A', '#E8C52B', '#E8C42D', '#E8C32F', '#E8C231', '#E8C133', '#E8C035', '#E8BF36', '#E9BE38', '#E9BD3A', '#E9BC3C', '#E9BB3E', '#E9BB40', '#E9BA42', '#E9B943', '#E9B945', '#E9B847', '#E9B749', '#EAB74B', '#EAB64D', '#EAB64F', '#EAB550', '#EAB552', '#EAB454', '#EAB456', '#EAB358', '#EAB35A', '#EAB35C', '#EBB25D', '#EBB25F', '#EBB261', '#EBB263', '#EBB165', '#EBB167', '#EBB169', '#EBB16B', '#EBB16C', '#EBB16E', '#ECB170', '#ECB172', '#ECB174', '#ECB176', '#ECB178', '#ECB17A', '#ECB17C', '#ECB17E', '#ECB27F', '#ECB281', '#EDB283', '#EDB285', '#EDB387', '#EDB389', '#EDB38B', '#EDB48D', '#EDB48F', '#EDB591', '#EDB593', '#EDB694', '#EEB696', '#EEB798', '#EEB89A', '#EEB89C', '#EEB99E', '#EEBAA0', '#EEBAA2', '#EEBBA4', '#EEBCA6', '#EEBDA8', '#EFBEAA', '#EFBEAC', '#EFBFAD', '#EFC0AF', '#EFC1B1', '#EFC2B3', '#EFC3B5', '#EFC4B7', '#EFC5B9', '#EFC7BB', '#F0C8BD', '#F0C9BF', '#F0CAC1', '#F0CBC3', '#F0CDC5', '#F0CEC7', '#F0CFC9', '#F0D1CB', '#F0D2CD', '#F0D3CF', '#F1D5D1', '#F1D6D3', '#F1D8D5', '#F1D9D7', '#F1DBD8', '#F1DDDA', '#F1DEDC', '#F1E0DE', '#F1E2E0', '#F1E3E2', '#F2E5E4', '#F2E7E6', '#F2E9E8', '#F2EBEA', '#F2ECEC', '#F2EEEE', '#F2F0F0', '#F2F2F2']
        const colors = [
          { min: 0, max: 0, color: '#D50637' },
          { min: 0, max: 10, color: '#E70000' },
          { min: 10, max: 20, color: '#FC2603' },
          { min: 20, max: 30, color: '#F74F14' },
          { min: 30, max: 40, color: '#F9FAD5' },
          { min: 40, max: 50, color: '#EEFDCA' },
          { min: 50, max: 60, color: '#4349C9' },
          { min: 60, max: 70, color: '#5440B6' },
          { min: 70, max: 80, color: '#4621A4' },
          { min: 80, max: 90, color: '#330D80' },
          { min: 90, max: 100, color: '#080000' }
        ]
        kriging.plot(canvas, grid, [97.3481, 108.5467], [26.0459, 34.3129], colors)
      }

      function returnImgae() {
        const mycanvas = document.getElementById('canvasMap')
        return mycanvas.toDataURL('image/png')
      }

      loadkriging()

      const imageBounds = [[26.0459, 97.3481], [34.3129, 108.5467]]
      L.imageOverlay(returnImgae(), imageBounds, { opacity: 0.6 }).addTo(map)
    })
  }

  function loadRain() {
    const param = {
      month: 7,
      day: 1,
      hour: 1
    }
    //移除除底图外的所有图层
    map.eachLayer(function(layer) {
      if (!layer._container || ('' + $(layer._container).attr('class')).replace(/\s/g, '') !== 'leaflet-layer') {
        layer.remove()
      }
    })
    for (var key in map.boxZoom._map._layers) {
      delete map.boxZoom._map._layers[key]
    }
    axios.get('http://localhost:3000/weathers/kri-hour', { params: param }).then(res => {
      points = res.data.result
      console.log(points)

      function loadkriging() {
        const canvas = document.getElementById('canvasMap')
        canvas.width = 1000
        canvas.height = 1000
        const n = points.length
        let t = [] // 温度
        let x = [] // 经度
        let y = [] // 纬度
        let r = [] // 降雨
        let prs = [] //气压  pressure
        let rhu = [] //相对湿度  relative humidity
        let stationId = []  // 站点号
        let stationName = [] // 站点名
        let observe_alt = [] // 观测场海拔
        const myIcon = L.divIcon({
          className: 'icon'
        })
        const redIcon = L.divIcon({
          className: 'icon-red'
        })
        for (let i = 0; i < n; i++) {
          t.push(parseFloat(points[i].TEM))
          r.push(parseFloat(points[i].PRE_1h))
          prs.push(parseFloat(points[i].PRS))
          rhu.push(parseFloat(points[i].RHU))
          x.push(parseFloat(points[i].docs[0].lon))  // lon
          y.push(parseFloat(points[i].docs[0].lat))  // lat
          stationName.push(points[i].docs[0].Station_name)
          stationId.push(points[i].docs[0].Station_Id_C)
          observe_alt.push(points[i].docs[0].Observe_alt)
          // L.circle([y[i], x[i]], {radius: 1}).addTo(map);
          if (points[i].PRE_1h < 16) {
            L.marker([y[i], x[i]], { icon: myIcon }).addTo(map).on('click', function(e) {
              let point = formatPoint(y[i], x[i])
              console.log(r[i])
              console.log(point)
              document.querySelector('.station-name').innerHTML = stationName[i]
              document.querySelector('.station-id').innerHTML = stationId[i]
              document.querySelector('.station-lon').innerHTML = point[1]
              document.querySelector('.station-lat').innerHTML = point[0]
              document.querySelector('.observe-alt').innerHTML = `${observe_alt[i]}m`
              document.querySelector('.temp').innerHTML = t[i] + '&#8451'
              document.querySelector('.rain').innerHTML = r[i] + 'mm'
              sidebar.show()
              // 侧边栏跳转
              const hourTemp = document.querySelector('.hour-temp')
              const hourRain = document.querySelector('.hour-rain')
              const dayTemp = document.querySelector('.day-temp')
              const dayRain = document.querySelector('.day-rain')

              function toHourTemp() {
                window.location.href = `http://localhost:9528/#/station/hourtemp?stationName=${stationName[i]}`
              }

              function toHourRain() {
                window.location.href = `http://localhost:9528/#/station/hourrain?stationName=${stationName[i]}`
              }

              function toDayTemp() {
                window.location.href = `http://localhost:9528/#/station/daytemp?stationName=${stationName[i]}`
              }

              function toDayRain() {
                window.location.href = `http://localhost:9528/#/station/dayrain?stationName=${stationName[i]}`
              }

              hourTemp.addEventListener('click', toHourTemp)
              hourRain.addEventListener('click', toHourRain)
              dayTemp.addEventListener('click', toDayTemp)
              dayRain.addEventListener('click', toDayRain)
            }).on('mouseover', function(e) {
              e.target.options.className = 'icon-hover'
              this.bindPopup(`${stationName[i]}:${r[i]}mm`).openPopup()
            }).on('mouseout', function() {
              this.closePopup()
            })
          } else {
            L.marker([y[i], x[i]], { icon: redIcon, highlight: 'permanent' }).addTo(map).on('click', function(e) {
              let point = formatPoint(y[i], x[i])
              document.querySelector('.station-name').innerHTML = `气象站名：${stationName[i]}`
              document.querySelector('.station-id').innerHTML = stationId[i]
              document.querySelector('.station-lon').innerHTML = point[1]
              document.querySelector('.station-lat').innerHTML = point[0]
              document.querySelector('.observe-alt').innerHTML = `${observe_alt[i]}m`
              document.querySelector('.temp').innerHTML = t[i] + '&#8451'
              document.querySelector('.rain').innerHTML = r[i] + 'mm'
              document.querySelector('.rhu').innerHTML = rhu[i] + '%'
              document.querySelector('.prs').innerHTML = prs[i] + 'hpa'
              sidebar.show()
            }).on('mouseover', function(e) {
              e.target.options.className = 'icon-hover'
              this.bindPopup(`${stationName[i]}:${r[i]}mm`).openPopup()
            }).on('mouseout', function() {
              this.closePopup()
            })
          }

        }

        // 根据属性范围设置渲染颜色
        function getColor(d) {
          return d > 50 ? '#710100' :
            d > 20 ? '#de5000' :
              d > 10 ? '#fa03f0' :
                d > 8 ? '#03714e' :
                  d > 6 ? '#0002fe' :
                    d > 4 ? '#67b4f8' :
                      d > 2 ? '#37a600' :
                        d > 0.1 ? '#9cf790' :
                          'rgba(255, 0, 0)'
        }

        // 清除图例
        if (document.querySelector('.legend') !== null) {
          document.querySelector('.legend').parentNode.removeChild(document.querySelector('.legend').parentNode.firstChild)
        }
        //图例

        var legend = L.control({ position: 'bottomright' })

        legend.onAdd = function(map) {
          var div = L.DomUtil.create('div', 'info legend'),
            grades = [0.1, 2, 4, 6, 8, 10, 20, 50],
            labels = []
          for (var i = 0; i < grades.length; i++) {
            div.innerHTML +=
              '<i style="background:' + getColor(grades[i] + 1) + '"></i>' +
              grades[i] + (grades[i + 1] ? '&ndash;' + grades[i + 1] + '<br>' : '+')
          }
          return div
        }
        legend.addTo(map)

        let variogram = kriging.train(r, x, y, 'exponential', 0, 100)
        const width = 0.05
        let grid = kriging.grid(world, variogram, width)
        // const colors = ['#00A600', '#01A600', '#03A700', '#04A700', '#05A800', '#07A800', '#08A900', '#09A900', '#0BAA00', '#0CAA00', '#0DAB00', '#0FAB00', '#10AC00', '#12AC00', '#13AD00', '#14AD00', '#16AE00', '#17AE00', '#19AF00', '#1AAF00', '#1CB000', '#1DB000', '#1FB100', '#20B100', '#22B200', '#23B200', '#25B300', '#26B300', '#28B400', '#29B400', '#2BB500', '#2CB500', '#2EB600', '#2FB600', '#31B700', '#33B700', '#34B800', '#36B800', '#37B900', '#39B900', '#3BBA00', '#3CBA00', '#3EBB00', '#3FBB00', '#41BC00', '#43BC00', '#44BD00', '#46BD00', '#48BE00', '#49BE00', '#4BBF00', '#4DBF00', '#4FC000', '#50C000', '#52C100', '#54C100', '#55C200', '#57C200', '#59C300', '#5BC300', '#5DC400', '#5EC400', '#60C500', '#62C500', '#64C600', '#66C600', '#67C700', '#69C700', '#6BC800', '#6DC800', '#6FC900', '#71C900', '#72CA00', '#74CA00', '#76CB00', '#78CB00', '#7ACC00', '#7CCC00', '#7ECD00', '#80CD00', '#82CE00', '#84CE00', '#86CF00', '#88CF00', '#8AD000', '#8BD000', '#8DD100', '#8FD100', '#91D200', '#93D200', '#95D300', '#97D300', '#9AD400', '#9CD400', '#9ED500', '#A0D500', '#A2D600', '#A4D600', '#A6D700', '#A8D700', '#AAD800', '#ACD800', '#AED900', '#B0D900', '#B2DA00', '#B5DA00', '#B7DB00', '#B9DB00', '#BBDC00', '#BDDC00', '#BFDD00', '#C2DD00', '#C4DE00', '#C6DE00', '#C8DF00', '#CADF00', '#CDE000', '#CFE000', '#D1E100', '#D3E100', '#D6E200', '#D8E200', '#DAE300', '#DCE300', '#DFE400', '#E1E400', '#E3E500', '#E6E600', '#E6E402', '#E6E204', '#E6E105', '#E6DF07', '#E6DD09', '#E6DC0B', '#E6DA0D', '#E6D90E', '#E6D710', '#E6D612', '#E7D414', '#E7D316', '#E7D217', '#E7D019', '#E7CF1B', '#E7CE1D', '#E7CD1F', '#E7CB21', '#E7CA22', '#E7C924', '#E8C826', '#E8C728', '#E8C62A', '#E8C52B', '#E8C42D', '#E8C32F', '#E8C231', '#E8C133', '#E8C035', '#E8BF36', '#E9BE38', '#E9BD3A', '#E9BC3C', '#E9BB3E', '#E9BB40', '#E9BA42', '#E9B943', '#E9B945', '#E9B847', '#E9B749', '#EAB74B', '#EAB64D', '#EAB64F', '#EAB550', '#EAB552', '#EAB454', '#EAB456', '#EAB358', '#EAB35A', '#EAB35C', '#EBB25D', '#EBB25F', '#EBB261', '#EBB263', '#EBB165', '#EBB167', '#EBB169', '#EBB16B', '#EBB16C', '#EBB16E', '#ECB170', '#ECB172', '#ECB174', '#ECB176', '#ECB178', '#ECB17A', '#ECB17C', '#ECB17E', '#ECB27F', '#ECB281', '#EDB283', '#EDB285', '#EDB387', '#EDB389', '#EDB38B', '#EDB48D', '#EDB48F', '#EDB591', '#EDB593', '#EDB694', '#EEB696', '#EEB798', '#EEB89A', '#EEB89C', '#EEB99E', '#EEBAA0', '#EEBAA2', '#EEBBA4', '#EEBCA6', '#EEBDA8', '#EFBEAA', '#EFBEAC', '#EFBFAD', '#EFC0AF', '#EFC1B1', '#EFC2B3', '#EFC3B5', '#EFC4B7', '#EFC5B9', '#EFC7BB', '#F0C8BD', '#F0C9BF', '#F0CAC1', '#F0CBC3', '#F0CDC5', '#F0CEC7', '#F0CFC9', '#F0D1CB', '#F0D2CD', '#F0D3CF', '#F1D5D1', '#F1D6D3', '#F1D8D5', '#F1D9D7', '#F1DBD8', '#F1DDDA', '#F1DEDC', '#F1E0DE', '#F1E2E0', '#F1E3E2', '#F2E5E4', '#F2E7E6', '#F2E9E8', '#F2EBEA', '#F2ECEC', '#F2EEEE', '#F2F0F0', '#F2F2F2']
        const colors = [
          { min: 0, max: 0.1, color: 'rgba(255, 0, 0, 0)' },
          { min: 0.1, max: 2, color: '#9cf790' },
          { min: 2, max: 4, color: '#37a600' },
          { min: 4, max: 6, color: '#67b4f8' },
          { min: 6, max: 8, color: '#0002fe' },
          { min: 8, max: 10, color: '#03714e' },
          { min: 10, max: 20, color: '#fa03f0' },
          { min: 20, max: 50, color: '#de5000' },
          { min: 50, max: 100, color: '#710100' }
        ]
        // const colors = [
        //   'rgba(255, 255, 255, 0)',
        //   'rgba(164, 245, 140, 1)',
        //   'rgba(164, 245, 140, 1)',
        //   'rgba(164, 245, 140, 1)',
        //   'rgba(164, 245, 140, 1)',
        //   'rgba(164, 245, 140, 1)'
        // ]
        kriging.plot(canvas, grid, [97.3481, 108.5467], [26.0459, 34.3129], colors)
      }

      function returnImgae() {
        const mycanvas = document.getElementById('canvasMap')
        return mycanvas.toDataURL('image/png')
      }

      loadkriging()

      const imageBounds = [[26.0459, 97.3481], [34.3129, 108.5467]]
      L.imageOverlay(returnImgae(), imageBounds, { opacity: 0.8 }).addTo(map)
    })
  }

  function loadPressure() {
    const param = {
      month: 7,
      day: 1,
      hour: 1
    }
    //移除除底图外的所有图层
    map.eachLayer(function(layer) {
      if (!layer._container || ('' + $(layer._container).attr('class')).replace(/\s/g, '') !== 'leaflet-layer') {
        layer.remove()
      }
    })
    for (var key in map.boxZoom._map._layers) {
      delete map.boxZoom._map._layers[key]
    }
    axios.get('http://localhost:3000/weathers/kri-hour', { params: param }).then(res => {
      points = res.data.result
      console.log(points)

      function loadkriging() {
        const canvas = document.getElementById('canvasMap')
        canvas.width = 1000
        canvas.height = 1000
        const n = points.length
        let t = [] // 温度
        let x = [] // 经度
        let y = [] // 纬度
        let r = [] // 降雨
        let prs = [] //气压  pressure
        let rhu = [] //相对湿度  relative humidity
        let stationId = []  // 站点号
        let stationName = [] // 站点名
        let observe_alt = [] // 观测场海拔
        const myIcon = L.divIcon({
          className: 'icon'
        })
        const redIcon = L.divIcon({
          className: 'icon-red'
        })
        for (let i = 0; i < n; i++) {
          t.push(parseFloat(points[i].TEM))
          r.push(parseFloat(points[i].PRE_1h))
          prs.push(parseFloat(points[i].PRS))
          rhu.push(parseFloat(points[i].RHU))
          x.push(parseFloat(points[i].docs[0].lon))  // lon
          y.push(parseFloat(points[i].docs[0].lat))  // lat
          stationName.push(points[i].docs[0].Station_name)
          stationId.push(points[i].docs[0].Station_Id_C)
          observe_alt.push(points[i].docs[0].Observe_alt)
          // L.circle([y[i], x[i]], {radius: 1}).addTo(map);
          if (points[i].PRE_1h < 16) {
            L.marker([y[i], x[i]], { icon: myIcon }).addTo(map).on('click', function(e) {
              let point = formatPoint(y[i], x[i])
              document.querySelector('.station-name').innerHTML = stationName[i]
              document.querySelector('.station-id').innerHTML = stationId[i]
              document.querySelector('.station-lon').innerHTML = point[1]
              document.querySelector('.station-lat').innerHTML = point[0]
              document.querySelector('.observe-alt').innerHTML = `${observe_alt[i]}m`
              document.querySelector('.temp').innerHTML = t[i] + '&#8451'
              document.querySelector('.rain').innerHTML = r[i] + 'mm'
              sidebar.show()
              // 侧边栏跳转
              const hourTemp = document.querySelector('.hour-temp')
              const hourRain = document.querySelector('.hour-rain')
              const dayTemp = document.querySelector('.day-temp')
              const dayRain = document.querySelector('.day-rain')

              function toHourTemp() {
                window.location.href = `http://localhost:9528/#/station/hourtemp?stationName=${stationName[i]}`
              }

              function toHourRain() {
                window.location.href = `http://localhost:9528/#/station/hourrain?stationName=${stationName[i]}`
              }

              function toDayTemp() {
                window.location.href = `http://localhost:9528/#/station/daytemp?stationName=${stationName[i]}`
              }

              function toDayRain() {
                window.location.href = `http://localhost:9528/#/station/dayrain?stationName=${stationName[i]}`
              }

              hourTemp.addEventListener('click', toHourTemp)
              hourRain.addEventListener('click', toHourRain)
              dayTemp.addEventListener('click', toDayTemp)
              dayRain.addEventListener('click', toDayRain)
            }).on('mouseover', function(e) {
              e.target.options.className = 'icon-hover'
              this.bindPopup(`${stationName[i]}:${rhu[i]}%`).openPopup()
            }).on('mouseout', function() {
              this.closePopup()
            })
          } else {
            L.marker([y[i], x[i]], { icon: redIcon, highlight: 'permanent' }).addTo(map).on('click', function(e) {
              let point = formatPoint(y[i], x[i])
              document.querySelector('.station-name').innerHTML = `气象站名：${stationName[i]}`
              document.querySelector('.station-id').innerHTML = stationId[i]
              document.querySelector('.station-lon').innerHTML = point[1]
              document.querySelector('.station-lat').innerHTML = point[0]
              document.querySelector('.observe-alt').innerHTML = `${observe_alt[i]}m`
              document.querySelector('.temp').innerHTML = t[i] + '&#8451'
              document.querySelector('.rain').innerHTML = r[i] + 'mm'
              document.querySelector('.rhu').innerHTML = rhu[i] + '%'
              document.querySelector('.prs').innerHTML = prs[i] + 'hpa'
              sidebar.show()
            }).on('mouseover', function(e) {
              e.target.options.className = 'icon-hover'
              this.bindPopup(`${stationName[i]}:${r[i]}mm`).openPopup()
            }).on('mouseout', function() {
              this.closePopup()
            })
          }

        }

        // 根据属性范围设置渲染颜色
        // function getColor(d) {
        //     return d > 1000 ? '#800026' :
        //         d > 500 ? '#BD0026' :
        //             d > 200 ? '#E31A1C' :
        //                 d > 100 ? '#FC4E2A' :
        //                     d > 50 ? '#FD8D3C' :
        //                         d > 20 ? '#FEB24C' :
        //                             d > 10 ? '#FED976' :
        //                                 '#FFEDA0';
        // }
        // //图例
        // var legend = L.control({position:'bottomright'});
        //
        // legend.onAdd = function(map){
        //     var div = L.DomUtil.create('div','info legend'),
        //         grades = [0,10,20,50,100,200,500,1000],
        //         labels=[];
        //     for(var i=0;i<grades.length;i++){
        //         div.innerHTML +=
        //             '<i style="background:'+getColor(grades[i]+1)+'"></i>'+
        //             grades[i]+(grades[i+1]?'&ndash;'+grades[i+1]+'<br>':'+');
        //     }
        //     return div;
        // }
        // legend.addTo(map);

        let variogram = kriging.train(rhu, x, y, 'exponential', 0, 100)
        const width = 0.05
        let grid = kriging.grid(world, variogram, width)
        // const colors = ['#00A600', '#01A600', '#03A700', '#04A700', '#05A800', '#07A800', '#08A900', '#09A900', '#0BAA00', '#0CAA00', '#0DAB00', '#0FAB00', '#10AC00', '#12AC00', '#13AD00', '#14AD00', '#16AE00', '#17AE00', '#19AF00', '#1AAF00', '#1CB000', '#1DB000', '#1FB100', '#20B100', '#22B200', '#23B200', '#25B300', '#26B300', '#28B400', '#29B400', '#2BB500', '#2CB500', '#2EB600', '#2FB600', '#31B700', '#33B700', '#34B800', '#36B800', '#37B900', '#39B900', '#3BBA00', '#3CBA00', '#3EBB00', '#3FBB00', '#41BC00', '#43BC00', '#44BD00', '#46BD00', '#48BE00', '#49BE00', '#4BBF00', '#4DBF00', '#4FC000', '#50C000', '#52C100', '#54C100', '#55C200', '#57C200', '#59C300', '#5BC300', '#5DC400', '#5EC400', '#60C500', '#62C500', '#64C600', '#66C600', '#67C700', '#69C700', '#6BC800', '#6DC800', '#6FC900', '#71C900', '#72CA00', '#74CA00', '#76CB00', '#78CB00', '#7ACC00', '#7CCC00', '#7ECD00', '#80CD00', '#82CE00', '#84CE00', '#86CF00', '#88CF00', '#8AD000', '#8BD000', '#8DD100', '#8FD100', '#91D200', '#93D200', '#95D300', '#97D300', '#9AD400', '#9CD400', '#9ED500', '#A0D500', '#A2D600', '#A4D600', '#A6D700', '#A8D700', '#AAD800', '#ACD800', '#AED900', '#B0D900', '#B2DA00', '#B5DA00', '#B7DB00', '#B9DB00', '#BBDC00', '#BDDC00', '#BFDD00', '#C2DD00', '#C4DE00', '#C6DE00', '#C8DF00', '#CADF00', '#CDE000', '#CFE000', '#D1E100', '#D3E100', '#D6E200', '#D8E200', '#DAE300', '#DCE300', '#DFE400', '#E1E400', '#E3E500', '#E6E600', '#E6E402', '#E6E204', '#E6E105', '#E6DF07', '#E6DD09', '#E6DC0B', '#E6DA0D', '#E6D90E', '#E6D710', '#E6D612', '#E7D414', '#E7D316', '#E7D217', '#E7D019', '#E7CF1B', '#E7CE1D', '#E7CD1F', '#E7CB21', '#E7CA22', '#E7C924', '#E8C826', '#E8C728', '#E8C62A', '#E8C52B', '#E8C42D', '#E8C32F', '#E8C231', '#E8C133', '#E8C035', '#E8BF36', '#E9BE38', '#E9BD3A', '#E9BC3C', '#E9BB3E', '#E9BB40', '#E9BA42', '#E9B943', '#E9B945', '#E9B847', '#E9B749', '#EAB74B', '#EAB64D', '#EAB64F', '#EAB550', '#EAB552', '#EAB454', '#EAB456', '#EAB358', '#EAB35A', '#EAB35C', '#EBB25D', '#EBB25F', '#EBB261', '#EBB263', '#EBB165', '#EBB167', '#EBB169', '#EBB16B', '#EBB16C', '#EBB16E', '#ECB170', '#ECB172', '#ECB174', '#ECB176', '#ECB178', '#ECB17A', '#ECB17C', '#ECB17E', '#ECB27F', '#ECB281', '#EDB283', '#EDB285', '#EDB387', '#EDB389', '#EDB38B', '#EDB48D', '#EDB48F', '#EDB591', '#EDB593', '#EDB694', '#EEB696', '#EEB798', '#EEB89A', '#EEB89C', '#EEB99E', '#EEBAA0', '#EEBAA2', '#EEBBA4', '#EEBCA6', '#EEBDA8', '#EFBEAA', '#EFBEAC', '#EFBFAD', '#EFC0AF', '#EFC1B1', '#EFC2B3', '#EFC3B5', '#EFC4B7', '#EFC5B9', '#EFC7BB', '#F0C8BD', '#F0C9BF', '#F0CAC1', '#F0CBC3', '#F0CDC5', '#F0CEC7', '#F0CFC9', '#F0D1CB', '#F0D2CD', '#F0D3CF', '#F1D5D1', '#F1D6D3', '#F1D8D5', '#F1D9D7', '#F1DBD8', '#F1DDDA', '#F1DEDC', '#F1E0DE', '#F1E2E0', '#F1E3E2', '#F2E5E4', '#F2E7E6', '#F2E9E8', '#F2EBEA', '#F2ECEC', '#F2EEEE', '#F2F0F0', '#F2F2F2']
        const colors = [
          { min: 0, max: 0, color: '#D50637' },
          { min: 0, max: 10, color: '#E70000' },
          { min: 10, max: 20, color: '#FC2603' },
          { min: 20, max: 30, color: '#F74F14' },
          { min: 30, max: 40, color: '#F9FAD5' },
          { min: 40, max: 50, color: '#EEFDCA' },
          { min: 50, max: 60, color: '#4349C9' },
          { min: 60, max: 70, color: '#5440B6' },
          { min: 70, max: 80, color: '#4621A4' },
          { min: 80, max: 90, color: '#330D80' },
          { min: 90, max: 100, color: '#080000' }
        ]
        kriging.plot(canvas, grid, [97.3481, 108.5467], [26.0459, 34.3129], colors)
      }

      function returnImgae() {
        const mycanvas = document.getElementById('canvasMap')
        return mycanvas.toDataURL('image/png')
      }

      loadkriging()

      const imageBounds = [[26.0459, 97.3481], [34.3129, 108.5467]]
      L.imageOverlay(returnImgae(), imageBounds, { opacity: 0.6 }).addTo(map)
    })
  }

  setTimeout(function() {
    loadTemp(6, 26)
  }, 20)
  map.on('mousemove', function(e) {
    // console.log(e.sourceTarget.boxZoom._map._zoom)
    document.querySelector('.zoom').innerText = `Zoom:${e.sourceTarget.boxZoom._map._zoom}`
    document.querySelector('.lon').innerText = `Lon:${e.latlng.lng}`
    document.querySelector('.lat').innerText = `Lat:${e.latlng.lat}`
    // console.log(e.latlng.lat, e.latlng.lng)`
  })
  // 切换要素
  const tempBtn = document.querySelector('.temp-btn')
  const rainBtn = document.querySelector('.rain-btn')
  const humidityBtn = document.querySelector('.humidity-btn')
  tempBtn.addEventListener('click', loadTemp)
  rainBtn.addEventListener('click', loadRain)
  humidityBtn.addEventListener('click', loadHumidity)

  // 日期选择相关
  const $selectControl = document.querySelector('.js-select-calendar')

  // 自定义下拉框option状态处理
  function optionHandler($target) {
    $target = $target.parentNode
    if ($target.classList.contains('folder')) {
      $target.classList.remove('folder')
      $target.classList.add('spread')
    } else {
      $target.classList.remove('spread')
      $target.classList.add('folder')
    }
  }

  // 日历插件初始化
  function initSchedule() {
    const mySchedule = new SchedulePlugin({
      el: '.js-option-calendar',
      clickCb: (y, m, d) => {
        const selectTime = `${y}-${m}-${d}`
        const $target = document.querySelector('.js-select-calendar .text')
        console.log(y, m, d)
        loadTemp(m, d)
        $target.classList.add('completed')
        $target.innerText = selectTime
        optionHandler($selectControl)
      }
    })
  }

  // 事件绑定
  function bindBtn() {
    $selectControl.addEventListener('click', function() {
      sidebar.hide()
      optionHandler(this)
    })
  }

  // 初始化
  function init() {
    initSchedule()
    bindBtn()
    const date = new Date()
    document.querySelector('.text').innerText = `${date.getFullYear()}-${date.getMonth() + 1}-${date.getDate()}`
  }

  init()
</script>
<script>

</script>
</body>
</html>
